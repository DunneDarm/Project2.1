/*
 * Begrensing.c
 *
 * Created: 11-11-2019 13:36:28
 * Author : sybku
 */ 

#include <avr/io.h>
#define F_CPU 16E6
#include <util/delay.h>

#define LED1 0
#define LED2 1
#define LED3 2

volatile uint8_t gv_status;
int current_uitrol;
int min_uitrol;
int max_uitrol;

int current_licht;
int licht_grens_MAX = 250;
int licht_grens_MIN = 100;
int current_temp;
int temp_grens_MAX = 30;
int temp_grens_MIN = 5;

void Rol_uit_in()
{
	if (gv_status == 0)//Als het rolluik is opgerold
	{
		while (current_uitrol < max_uitrol)
		{
			PORTB |= (1 << LED2);
			PORTB |= (1 << LED3);
			_delay_ms(100);
			current_uitrol += 10;
			PORTB &=~ (1 << LED3);
			_delay_ms(100);
		}
		PORTB &=~ (1 << LED2);
	}
	if (gv_status == 1)//Als het rolluik is uitgerold
	{
		while (current_uitrol > min_uitrol)
		{
			PORTB |= (1 << LED1);
			PORTB |= (1 << LED3);
			_delay_ms(100);
			current_uitrol -= 10;
			PORTB &=~ (1 << LED3);
			_delay_ms(100);
		}
		PORTB &=~ (1 << LED1);
	}
}

void check_temp()
{
	if(current_temp >= temp_grens_MAX)
	{
		gv_status = 0;	
		Rol_uit_in();
	}
	if (current_temp <= temp_grens_MIN)
	{
		gv_status = 0;
		Rol_uit_in();
	}
	if(current_temp > temp_grens_MIN && current_temp < temp_grens_MAX && gv_status == 0)
	{
		gv_status = 1;
		Rol_uit_in();
	}

}

void check_licht()
{
	if (current_licht >= licht_grens_MAX)
	{
		gv_status = 0;
		Rol_uit_in();
	}
	if (current_licht <= licht_grens_MIN)
	{
		gv_status = 0;
		Rol_uit_in();
	}
	if(current_licht > licht_grens_MIN && current_licht < licht_grens_MAX && gv_status == 0)
	{
		gv_status = 1;
		Rol_uit_in();
	}
}

int main(void)
{
	DDRB = 0xff;
	current_uitrol = 0;
	max_uitrol = 300;
	min_uitrol = 0;
	current_licht = 200;
	current_temp = 25;
	gv_status = 0;
    while (1) 
    {
		check_licht();
		//check_temp();
		_delay_ms(5000);
		current_temp = 31;
		current_licht = 260;
    }
}

